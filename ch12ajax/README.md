# AJAX

## URL、URI、URN

URI：统一资源标识符，URI就像英特网上的邮政地址一样，在世界范围内唯一标识并定位信息资源；
     URI 有两种形式，分别为URL 和 URN

URL：统一资源定位符是资源标识符的最常见形式， URL描述了一台特定服务器上某资源的特定位置。
URN：URI 的第二种形式为统一资源名，URN 是作为特定内容的唯一名称使用的，与目前的资源所在地无关。
     比如，不论英特网标准文档RFC 2141 位于何处，都可以用下列URN命名它：
     urn:ietf:rfc:2141

示例：http://v.qq.com:80/index.html?name=zhangsan&age=22#bbs
http: 传输协议 
     （http:默认端口80；https：默认端口443； FTP文件传输协议：默认21端口）
v.qq.com ：域名
80 端口
index.html ： 请求资源文件名
?name=zhangsan&age=22 URL传参
#bbs ：URL的hash （锚点定位）


## node

node 模块：
1. 内置模块
2. 自定义模块
    module.exports = {fn:fn}  
    module.exports.fn = fn;
3. 第三方模块  npm install/uninstall xxmodule  -g  ,-g 全局安装


## ajax

### ajax 流程
1. 创建 AJAX 对象（） ---  2.open ---- [ onreadystatechange 监听状态改变，触发对应的方法，非必需] ---- 3.send 

#### 1 创建AJAX 对象



#### 2 open 启动

1. 在使用XHR对象时，要调用的第一个方法是open()，如下所示，该方法接受3个参数：
    xhr.open("get","example.php", false,[username],[password]);
> open()方法的第一个参数用于指定发送请求的方式，这个字符串，不区分大小写，但通常使用大写字母。"GET"和"POST"是得到广泛支持的
> "GET"用于常规请求，它适用于当URL完全指定请求资源，当请求对服务器没有任何副作用以及当服务器的响应是可缓存的情况下
>  "POST"方法常用于HTML表单。它在请求主体中包含额外数据且这些数据常存储到服务器上的数据库中。相同URL的重复POST请求从服务器得到的响应可能不同，
   同时不应该缓存使用这个方法的请求
>  除了"GET"和"POST"之外，参数还可以是"HEAD"、"OPTIONS"、"PUT"。而由于安全风险的原因，"CONNECT"、"TRACE"、"TRACK"被禁止使用
>  open()方法的第二个参数是URL，该URL相对于执行代码的当前页面，且只能向同一个域中使用相同端口和协议的URL发送请求。如果URL与启动请求的页面有任何差别，都会引发安全错误
>  open()方法的第三个参数是表示是否异步发送请求的布尔值，如果不填写，默认为true，表示异步发送
>  如果请求一个受密码保护的URL，把用于认证的用户名和密码作为第4和第5个参数传递给open()方法


#### 2.1 同步/异步
 -  如果接受的是同步响应，则需要将open()方法的第三个参数设置为false，那么send()方法将阻塞直到请求完成。
 一旦send()返回，仅需要检查XHR对象的status和responseText属性即可。
 同步请求是吸引人的，但应该避免使用它们。客户端javascript是单线程的，当send()方法阻塞时，它通常会导致整个浏览器UI冻结。如果连接的服务器响应慢，那么用户的浏览器将冻结。

- 如果需要接收的是异步响应，这就需要检测XHR对象的 __readyState__ 属性，该属性表示请求/响应过程的当前活动阶段。这个readyState属性可取的值如下：
    0(UNSENT):未初始化。尚未调用open()方法
    1(OPENED):启动。已经调用open()方法，但尚未调用send()方法
    2(HEADERS_RECEIVED):发送。己经调用send()方法，且接收到头信息
    3(LOADING):接收。已经接收到部分响应主体信息
    4(DONE):完成。已经接收到全部响应数据，而且已经可以在客户端使用了

只要readyState属性值由一个值变成另外一个值，都会触发一次__onreadystatechange__  事件


#### 2.2 XHR 的属性
1. responseText: 作为响应主体被返回的文本(文本形式)
2. responseXML: 如果响应的内容类型是'text/xml'或'application/xml'，这个属性中将保存着响应数据的XML DOM文档(document形式)
3. status: HTTP状态码(数字形式)
4. statusText: HTTP状态说明(文本形式)


#### 2.3 HTTP状态码

【1XX】
  该部分状态码是信息性状态码，只有两个
【2XX】
  客户端发起请求时，这些请求通常是成功的。
【3XX】
   重定向状态码要么告知客户端使用替代位置来访问他们所感兴趣的资源，要么就提供一个替代的响应而不是资源的内容。
   如果资源已被移动，可发送一个重定向状态码和一个可选的Location首部来告知客户端资源已被移走，以及现在可以在哪里找到它。
   这样，浏览器就可以在不打扰使用者的情况下，透明地转入新的位置了
【4XX】
   有时客户端会发送一些服务器无法处理的东西，比如格式错误的请求报文，或者请求一个不存在的URL.
【5XX】
   有时客户端发送了一条有效请求，服务器自身却出错了。这可能是客户端碰上了服务器的缺陷，或者服务器上的子元素，
   比如某个网关资源出了错。代理尝试着代表客户端与服务器进行交流时，经常会出现问题。代理会发布5XX服务器错误状态码来描述所遇到的问题
![http状态码1](./htppstatus1.png)
![http状态码2](./htppstatus2.png)
![http状态码3](./htppstatus3.png)
![http状态码4](./htppstatus4.png)

常用状态码：
200 或 ^2\d{2}  :成功
301 ：永久重定向/永久转移
302 ：临时重定向/临时转移
400：客户端传参错误
401 ：无权访问（未授权）
403 ：禁止访问
404 ：地址错误
500： 未知的服务器错误

xhr.onreadystatechange = function(){
    if(xhr.readyState ==4 && /^2\d{2}$/.test(xhr.status)){
         var res = xhr.responseText;
    }
}

#### 2.4 HHTTP常用方法

HTTP常用方法共以下8种：  
GET：获取资源
POST：传输实体主体
PUT：传输文件
HEAD：获取报文首部
DELETE：删除文件
OPTIONS：询问支持的方法
TRACE：追踪路径
CONNECT：要求用隧道协议连接代理

- GET：GET是最常用的方法。通常用于请求服务器发送某个资源。

- POST：POST方法起初是用来向服务器输入数据的。实际上，通常会用它来支持HTML的表单。

- HEAD：EAD方法与GET方法的行为很类似，但服务器在响应中只返回首部。不会返回实体的主体部分。这就允许客户端在未获取实际资源的情况下，
对资源的首部进行检査。使用HEAD，可以：
1、在不获取资源的情况下了解资源的情况(比如，判断其类型)；
2、通过査看响应中的状态码，看看某个对象是否存在；
3、通过査看首部，测试资源是否被修改

- PUT： 与GET从服务器读取文档相反，PUT方法会向服务器写入文档。就像FTP协议的文件上传一样，要求在请求报文的主体中包含文件内容，然后保存到请求URI指定的位置。
但是，由于HTTP/1.1的PUT方法自身不带验证机制，任何人都可以上传文件，存在安全性问题，因此一般的Web网站不使用该方法。
若配合Web应用程序的验证机制，或架构设计采用REST(REpresentational State Transfer，表征状态转移)标准的同类Web网站，就可能会开放使用PUT方法。

- DELETE： DELETE方法所做的事情就是请服务器删除请求URL所指定的资源
但是，HTTP/1.1 的 DELETE 方法本身和 PUT 方法一样不带验证机制，所以一般的Web网站也不使用DELETE方法。
当配合Web应用程序的验证机制，或遵守REST标准时还是有可能会开放使用的

- TRACE：TRACE请求会在目的服务器端发起一个“环回”诊断。行程最后一站的服务器会弹回一条TRACE响应，并在响应主体中携带它收到的原始请求报文。
  这样客户端就可以査看在所有中间HTTP应用程序组成的请求/响应链上，原始报文是否，以及如何被毁坏或修改过。
  发送请求时，在Max-Forwards首部字段中填入数值，每经过一个服务器端就将该数字减 1，当数值刚好减到0时，
  就停止继续传输，最后接收到请求的服务器端则返回状态码 200 OK 的响应。
  但是，TRACE方法本来就不怎么常用，再加上它容易引发XST(Cross-Site Tracing，跨站追踪)攻击，通常就更不会用到了。

- OPTIONS： OPTIONS方法请求Web服务器告知其支持的各种功能。可以询问服务器通常支持哪些方法，或者对某些特殊资源支持哪些方法。
   这为客户端应用程序提供了一种手段，使其不用实际访问那些资源就能判定访问各种资源的最优方式。

-CONNECT：CONNECT方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。
  主要使用SSL(Secure Sockets Layer，安全套接层)和TLS(Transport Layer Security，传输层安全)协议把通信内容加密后经网络隧道传输。


send()

　　send()方法接收一个参数，即要作为请求主体发送的数据。调用send()方法后，请求被分派到服务器

　　如果是GET方法，send()方法无参数，或参数为null；如果是POST方法，send()方法的参数为要发送的数据

xhr.open("get", "example.txt", false);
xhr.send(null);